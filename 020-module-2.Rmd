# Module 2

## Lecture


<!--<iframe width="640" height="360" src="YOUTUBE EMBED LINK" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>-->

### 2A
<iframe src="https://docs.google.com/presentation/d/1PzqDljdBka-mxb7osNcveBCvpzLRsKTS/preview" width="640" height="480" allow="autoplay"></iframe>  

### 2B
<iframe src="https://docs.google.com/presentation/d/1Dd5Dow29sairtG8tTLhsYChQV3qZGc5o/preview" width="640" height="480" allow="autoplay"></iframe>  




## Lab 2A
### Read data in to R

read CSV - base functions
```{r, eval=FALSE, message=FALSE}
bp <- read.csv2("Desktop/R/data/BloodPressure_Data.csv") # no sepqration
# take a quick look at the data
head(bp)
```

```{r, eval=FALSE, message=FALSE}
bp <- read.csv2("Desktop/R/data/BloodPressure_Data.csv", sep = ",") # no sepqration
# take another look at the data
head(bp)
str(bp)
```

readr functions
```{r, eval=FALSE, message=FALSE}
library(readr)
```

Read the CSV file
```{r, eval=FALSE, message=FALSE}
bp_data <- read_csv("Desktop/R/data/BloodPressure_Data.csv")
```

Take a quick look at the data
```{r, eval=FALSE, message=FALSE}
head(bp_data)
str(bp_data)
```

Work with date
```{r, eval=FALSE, message=FALSE}
library(readr)
library("lubridate")
```

read ALL data
```{r, eval=FALSE, message=FALSE}
bp <-  read.csv2("Desktop/R/data/BloodPressure_wDates.csv", sep = ",")
```

Convert date column and extract year
```{r, eval=FALSE, message=FALSE}
bp$Date <- ymd(bp$Date)
bp$Year <- year(bp$Date)
```

Filtering blood pressure patients by year and gender
```{r, eval=FALSE, message=FALSE}
subset(bp, Year == 2003 & Gender == "f")
```

### Conditions and loops

If {} else {} statement 
```{r, eval=FALSE, message=FALSE}
if (condition) {
  # code if TRUE
} else {
  # code if FALSE
}
```

```{r, eval=FALSE, message=FALSE}
# If else example
age <- 55
if (age > 50) {
  print("Older patient")
} else {
  print("Younger patient")
}
```

```{r, eval=FALSE, message=FALSE}
# If {} else if {} else statement 

if (condition1) {
  # code if condition1 is TRUE
} else if (condition2) {
  # code if condition2 is TRUE
} else {
  # code if none are TRUE
}
```

```{r, eval=FALSE, message=FALSE}
# If else if example
age <- 35

if (age < 18) {
  print("Child")
} else if (age >= 18 & age < 60) {
  print("Adult")
} else {
  print("Senior")
}
```

```{r, eval=FALSE, message=FALSE}
# for loops
for (i in 1:5) {
  print(i)
}
```

```{r, eval=FALSE, message=FALSE}
# for loop example
patients <- c("P1", "P2", "P3")
for (p in patients) {
  print(paste("Processing:", p))
}
```

```{r, eval=FALSE, message=FALSE}
# the apply () family vs. loops
# Using a for loop
m <- matrix(1:9, nrow=3)
row_sums <- c()
for (i in 1:nrow(m)) {
  row_sums[i] <- sum(m[i, ])
}
```

```{r, eval=FALSE, message=FALSE}
# Using apply()
row_sums2 <- apply(m, 1, sum)
```

```{r, eval=FALSE, message=FALSE}
# the apply() family
# apply()
apply(m, 1, sum)   # row sums
apply(m, 2, mean)  # column means
```

```{r, eval=FALSE, message=FALSE}
# lapply()
lapply(list(1:3, 4:6), mean)
```

```{r, eval=FALSE, message=FALSE}
# sapply()
sapply(list(1:3, 4:6), mean)
```

```{r, eval=FALSE, message=FALSE}
# lapply()
lapply(list(1:3, 4:6), mean)
```

```{r, eval=FALSE, message=FALSE}
# tapply()
ages <- c(21, 25, 30, 40, 35)
gender <- c("M", "M", "F", "F", "M")
tapply(ages, gender, mean)   # mean age by gender
```

```{r, eval=FALSE, message=FALSE}
# mapply()
nums1 <- 1:5
nums2 <- 6:10
mapply(sum, nums1, nums2)   # adds 1+6, 2+7, … 5+10
```


## Lab 2A Tasks


Task 1 – Basic Filtering

```{r, eval=FALSE, message=FALSE}
#Use a for loop with if/else conditions
Go through each row of the dataset and:
Print a message if the patient has High BP (> 140) # Tip: use the paste function, 
Print a message if the patient has Low BP (< 90)
Otherwise, mark them as Normal
# read data
bp_data <- read.csv2("Desktop/R/data/BloodPressure_wDates.csv", sep = ",")

# Use for loop
for (i in 1:nrow(bp_data)) {
  if (bp_data$BloodPressure[i] > 140) {
    print(paste("Patient", bp_data$ID[i], "has HIGH blood pressure"))
  } else if (bp_data$BloodPressure[i] < 90) {
    print(paste("Patient", bp_data$ID[i], "has LOW blood pressure"))
  } else {
    print(paste("Patient", bp_data$ID[i], "is NORMAL"))
  }
}


# Use apply() instead of loops
bp_data$BP_Status <- apply(bp_data, 1, function(row) {
  if (as.numeric(row["BloodPressure"]) > 140) {
    "HIGH"
  } else if (as.numeric(row["BloodPressure"]) < 90) {
    "LOW"
  } else {
    "NORMAL"
  }
})
```


## Lab 2B
### Basic plotting in R

Plot multiple panels in one plot
```{r, eval=FALSE, message=FALSE}
par(mfrow = c(3, 1))
layout(matrix(c(1, 1, 2, 3), nrow = 2, byrow = TRUE))
```

Histogram of Blood Pressure
```{r, eval=FALSE, message=FALSE}
hist(bp_data$BloodPressure, main="Blood Pressure Distribution",
     xlab="Blood Pressure", col="lightblue")
```

Boxplot of BP by Gender
```{r, eval=FALSE, message=FALSE}
boxplot(BloodPressure ~ Gender, data=bp_data,
        main="BP by Gender", xlab="Gender", ylab="Blood Pressure")
```

Scatterplot Age vs BP
```{r, eval=FALSE, message=FALSE}

plot(bp_data$Age, bp_data$BloodPressure,
     main="Age vs Blood Pressure", xlab="Age", ylab="BP")
```


### ggplot2

```{r, eval=FALSE, message=FALSE}
# example syntax 
#ggplot(data, aes(x, y)) + geom_*()
```

```{r, eval=FALSE, message=FALSE}
library(ggplot2)
# Scatterplot: Age vs Blood Pressure
ggplot(bp_data, aes(x=Age, y=BloodPressure)) +
  geom_point()
```


boxplot
```{r, eval=FALSE, message=FALSE}
ggplot(bp_data, aes(x=Group, y=BloodPressure)) +
  geom_boxplot()
```

Customizing ggplot2
```{r, eval=FALSE, message=FALSE}
ggplot(bp_data, aes(x = Age, y = BloodPressure)) +
  geom_point(color = "blue") +
  labs(
    title = "Age vs Blood Pressure",
    x = "Patient Age",
    y = "BP (mmHg)"
  ) +
  theme_minimal() 
```


```{r, eval=FALSE, message=FALSE}
# Save last plot as PNG
ggsave("Age_BP_Scatter.png", width=6, height=4)
```

```{r, eval=FALSE, message=FALSE}
# Save specific plot object
p <- ggplot(bp_data, aes(x=Age, y=BloodPressure)) +
  geom_point()
ggsave("data/scatter_plot.png", plot=p)
```


## Lab 2B Tasks

ggplot hands on tasks
```{r, eval=FALSE, message=FALSE}
library(lubridate)
library(ggplot2)
library(patchwork)
```

Load data
```{r, eval=FALSE, message=FALSE}
bp_data <- read.csv2("data/BloodPressure_wDates.csv", sep = ",")
```

Get the year in a new column
```{r, eval=FALSE, message=FALSE}
bp_data$Year <- year(bp_data$Date)
```


1. Bar plot: patient counts per group
```{r, eval=FALSE, message=FALSE}
# ggplot hands on tasks
ggplot(bp_data, aes(x=Group)) +
  geom_bar(fill="steelblue") +
  labs(title="Number of Patients per Group", x="Group", y="Count")
```

2. Histogram: Age distribution
```{r, eval=FALSE, message=FALSE}
ggplot(bp_data, aes(x=as.numeric(Age)))  +
  geom_histogram(binwidth=5, fill="lightgreen", color="black") +
  labs(title="Age Distribution of Patients", x="Age", y="Frequency")
```

3. Scatterplot: Age vs BloodPressure, colored by Group
```{r, eval=FALSE, message=FALSE}
ggplot(bp_data, aes(x=Age, y=BloodPressure, color=Group)) +
  geom_point() +
  labs(title="Age vs Blood Pressure by Group", 
       x="Age", y="Blood Pressure")
```


Bonus hands on
```{r, eval=FALSE, message=FALSE}
library(ggplot2)
library(patchwork)   # install.packages("patchwork") if needed
```

1. Bar plot
```{r, eval=FALSE, message=FALSE}
p1 <- ggplot(bp_data, aes(x = Gender, y = BloodPressure, fill = Gender)) +
  stat_summary(fun = "mean", geom = "bar") +
  labs(title = "Average BP by Gender") +
  theme_minimal()
```

2. Histogram
```{r, eval=FALSE, message=FALSE}
p2 <- ggplot(bp_data, aes(x=as.numeric(Age)))  +
  geom_histogram(binwidth=5, fill="lightgreen", color="black") +
  labs(title="Age Distribution of Patients", x="Age", y="Frequency")
```

3. Boxplot
```{r, eval=FALSE, message=FALSE}
p3 <- ggplot(bp_data, aes(x = Group, y = BloodPressure, fill = Group)) +
  geom_boxplot() +
  labs(title = "BP by Group") +
  theme_minimal()
```

Combine plots into one figure
```{r, eval=FALSE, message=FALSE}
# horizontal layout
(p1 | p2 | p3) 

# vertical layout
(p1 / p2 / p3)  

# 2x2 grid
(p1 | p2) / p3
```

  

 




























